<!DOCTYPE html>
<html xmlns:layout="http://www.w3.org/1999/xhtml"
	layout:decorate="~{layouts/layout}">
<head>

<title>Vet. CARES - ROOM CAPACITY</title>

</head>

<body>
	<main role="main" class="container-fluid" layout:fragment="content">
		<form id="roomCapacityForm"
			th:action="@{/setup/saveInstitutionUserRoomCapacitySetup}"
			method="post" data-ng-app="roomCapacityApp"
			data-ng-controller="RoomCapacityController">

			<input type="hidden" th:field="*{institution.id}"> 
			<input type="hidden" th:field="*{institution.allottedRooms}"
				data-ng-model="allottedRooms" id="allottedRooms">

			<div class="row justify-content-md-center">
				<div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
					<div class="row mt-3">
						<div class="col-12 text-right">
							<a th:href="@{/setup/getInstitutionUserRoomCapacitySetup}">
								<button type="button" class="btn btn-sm btn-primary">
									<i class="fa fa-angle-left"></i>&nbsp;Go Back
								</button>
							</a>
						</div>
					</div>
					<div class="row">
						<div class="col-12 text-center">
							<h6 class="font-weight-bold mt-1">CAPACITY</h6>
						</div>
					</div>

					<div class="card shadow-sm p-5 mt-3">
						<div class="row">
							<div class="col-sm-12">
								<div class="form-group">
									<label for="labName" class="text-gray-800">NAME</label>
									<div>
										<h5 class="font-weight-bold text-uppercase" th:text="${institution.name}"></h5>
									</div>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-sm-12">
								<div class="form-group">
									<label for="address" class="text-gray-800">ADDRESS</label> <input
										th:field="*{institution.address}" type="text"
										class="form-control" id="address" aria-describedby="emailHelp"
										placeholder="Enter Address">
									<div class="invalid-feedback">Please enter the
										Institution address</div>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-sm-12">
								<div class="form-group">
									<label for="district" class="text-gray-800">DISTRICT</label> <select
										class="browser-default custom-select" id="district"
										th:field="*{institution.district.id}" required>
										<option value="0">--Select--</option>
										<option th:each="dist : ${nativedistricts}"
											th:value="${dist.id}" th:text="${dist.districtName}"></option>
									</select>
									<div class="invalid-feedback">Please select the
										Institution district</div>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-sm-4">
								<div class="form-group">
									<label for="capacity" class="text-gray-800">TOTAL
										CAPACITY</label> <input th:field="*{institution.rooms}" type="text"
										class="form-control number-only" id="capacity"
										data-ng-modal="rooms" data-ng-keyup="updateCapacity()"
										aria-describedby="emailHelp" placeholder="Number of Rooms">
								</div>
							</div>

							<div class="col-sm-4">
								<div class="form-group">
									<label for="labDistrict" class="text-gray-800">ALLOTTED</label>
									<div>
										<span class="font-weight-bold text-warning cursor-pointer h5"
											th:text="${institution.allottedRooms}"></span>
									</div>
								</div>
							</div>

							<div class="col-sm-4">
								<div class="form-group">
									<label for="labDistrict" class="text-gray-800">BALANCE</label>
									<div>
										<span class="font-weight-bold text-success cursor-pointer h5"
											th:text="${institution.rooms-institution.allottedRooms}"></span>
									</div>
								</div>
							</div>

							<div class="col-sm-12">
								<span class="text-danger" id="capacityWarning"></span>
							</div>
						</div>
					</div>

					<div class="row m-4">
						<div class="col-sm-12 text-center">
							<button type="submit" id="updateCapacityBtn"
								class="btn btn-success px-3" onclick="return validateForm()"
								formnovalidate data-ng-disabled="rooms<allottedRooms">Update</button>
						</div>
					</div>

				</div>
			</div>

		</form>
	</main>
</body>
</html>

<script th:inline="javascript">
	$(document).ready(function () {
		$('#updateCapacityBtn').on('click', function (e) {
			var district = $("#district").val();
			if (district == 0 || district == null) {
				$("#district").addClass("is-invalid");
				return false;
			}
			return true;
		});
	});

	var application = angular.module('roomCapacityApp', []);
	application.controller('RoomCapacityController', function ($scope, $http, $compile) {
		$scope.allottedRooms = parseInt($('#allottedRooms').val());
		if (typeof $scope.allottedRooms === 'undefined'
			|| $scope.allottedRooms == null) {
			$scope.allottedRooms = 0;
		}
		
		$scope.rooms = parseInt($('#capacity').val());
		if (typeof $scope.rooms === 'undefined'
			|| $scope.rooms == null) {
			$scope.rooms = 0;
		}
		
		$scope.updateCapacity = function () {
			$scope.rooms = parseInt($('#capacity').val());
			if (typeof $scope.rooms === 'undefined'
				|| $scope.rooms == null) {
				$scope.rooms = 0;
			}
			
			$scope.allottedRooms = parseInt($('#allottedRooms').val());
			if (typeof $scope.allottedRooms === 'undefined'
				|| $scope.allottedRooms == null) {
				$scope.allottedRooms = 0;
			}
			
			if(parseInt($scope.rooms) < parseInt($scope.allottedRooms)) {
				$('#capacityWarning').show();
				$('#capacityWarning').text("Entered Capacity is less than Allotted");
			} else {
				$('#capacityWarning').hide();
			}
		};
		
		$scope.updateCapacity();
	});
</script>
